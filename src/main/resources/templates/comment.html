<!--<!DOCTYPE html>-->
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Comment</title>
    <link th:href="@{/styles/css/comment.css}" rel="stylesheet" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js">

</head>
<body>

    <div class="fragment">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>
                function replyToComment(userId, postId, commUserId, commentId, listSize, layer){
                    var url = 'http://localhost:8080/reply/' + userId + '/' + postId + '/' + commUserId + '/' + commentId;
                    alert(url);
                    var resultBlock = 'replySec' + commUserId + 'for' + userId + 'N' + listSize + 'layer' + layer;
                    console.log(resultBlock);

                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', url, true);
                    xhr.onload = () => {
                        console.log(xhr.status);
                        console.log(xhr);
                        console.log(xhr.responseText);
                        if (xhr.status === 200) {
                            // this is callback data: url
                            alert(xhr.responseText);
                            console.log(url);
                            document.getElementById(resultBlock).innerHTML = xhr.responseText;
                        }
                    };
                    xhr.send();
                }

        </script>

        <div class="container d-flex justify-content-center mt-100 mb-100">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="comment-widgets m-b-20">
                            <div class="d-flex flex-row comment-row">
                                <div class="p-2">
                                    <span class="round"><img src="https://i.imgur.com/uIgDDDd.jpg" alt="user" width="50"></span>
                                    <h5><label th:text="${user.firstName + ' ' + user.lastName}"/></h5>

                                <div class="comment-text w-100">
                                    <div class="comment-footer" th:unless="${comment.edit}">
                                        <span class="label label-info">Pending</span>
                                        <span class="action-icons">

                                            <a th:if="${mainUser.id == user.id}" th:href="@{/editComment/{postId}/{id}(id=${comment.id}, postId = ${post.postId})}" data-abc="true">
                                                <i class="fa fa-pencil"></i></a>

                                            <a href="#" data-abc="true"><i class="fa fa-rotate-right"></i></a>

                                            <a th:unless="${mainUser.id == user.id}" th:href="@{/likeComment/{postId}/{id}/{userId}(id=${comment.id}, postId = ${post.postId}, userId = ${mainUser.id})}" data-abc="true">
                                                <i class="fa fa-heart"><label th:text="${comment.likeAmount}"/></i></a>


                                        </span>
                                    </div>

                                    <p th:unless="${comment.edit}" class="m-b-5 m-t-10"><label th:text="${comment.commentBody}"/></p>

                                    <form th:if="${comment.edit}" class="edit_comm_form" th:action="@{/editComment/{postId}/{id}(postId=${post.postId}, id=${comment.id})}" method="get" th:object = "${comment}">
                                        <p class="m-b-5 m-t-10"><textarea th:text="${comment.commentBody}" class="comment_area" name="edit_comment_body" cols="90" rows="7"/></p>
                                        <button class="edit-delete" type="submit" value="Edit" name="editComment">Edit</button>
                                        <button class="edit-delete" type="submit" value="Delete" name="editComment">Delete</button>
                                    </form>

                                    <div th:unless="${comment.edit}" class="reply-section">
                                        <div class="d-flex flex-row align-items-center voting-icons">
                                            <span th:if="${mainUser.id == user.id}">
                                                <i class="fa fa-sort-up fa-2x mt-3 hit-voting"></i>
                                                <span class="ml-1"><label th:text="${comment.rating}"/></span>
                                                <i class="fa fa-sort-down fa-2x mb-3 hit-voting"></i>
                                            </span>
                                            <span th:unless="${mainUser.id == user.id}">
                                                <a th:href="@{/levelUpComment/{postId}/{id}/{userId}(id=${comment.id}, postId = ${post.postId}, userId = ${mainUser.id})}" data-abc="true">
                                                    <i class="fa fa-sort-up fa-2x mt-3 hit-voting"></i></a>
                                                <span class="ml-1"><label th:text="${comment.rating}"/></span>
                                                <a th:href="@{/lowerComment/{postId}/{id}/{userId}(id=${comment.id}, postId = ${post.postId}, userId = ${mainUser.id})}" data-abc="true"><i class="fa fa-sort-down fa-2x mb-3 hit-voting"></i></a>
                                            </span>

                                            <span class="dot ml-2"></span>
                                            <a id="myLink" title="Click to reply" href="#" th:attr="onclick=|replyToComment('${mainUser.id}', '${post.postId}', '${user.id}', '${comment.id}', ${#lists.size(comment.subComments)}, ${comment.layer})|" > <h6 class="ml-2 mt-1">Reply</h6> </a>
                                            <span class="date ml-5 mt-1"><label th:text="${comment.creationTime}" /></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        </div>
        <div th:id="'replySec' + ${user.id} + 'for' + ${mainUser.id} + 'N' + ${#lists.size(comment.subComments)} + 'layer' + ${comment.layer}">
        </div>
    </div>
</body>
</html>